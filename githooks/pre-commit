#!/bin/bash

# Limites (en octets)
MAX_FILE_SIZE=$((95 * 1024 * 1024))      # 95 Mo par fichier
MAX_TOTAL_SIZE=$((250 * 1024 * 1024))    # 250 Mo pour tous les fichiers

TOTAL_SIZE=0

# Liste des fichiers ajout√©s ou modifi√©s (staged uniquement)
FILES=$(git diff --cached --name-only --diff-filter=AM)

for file in $FILES; do
  # V√©rifie si le fichier existe r√©ellement (√©vite erreurs si supprim√©)
  if [ ! -f "$file" ]; then
    continue
  fi

  FILESIZE=$(wc -c <"$file")

  # V√©rifie la taille individuelle
  if [ "$FILESIZE" -gt "$MAX_FILE_SIZE" ]; then
    echo "‚ùå Le fichier '$file' d√©passe la taille maximale autoris√©e de 95 Mo (${FILESIZE} octets)."
    exit 1
  fi

  # Ajoute au total
  TOTAL_SIZE=$((TOTAL_SIZE + FILESIZE))
done

# V√©rifie la taille totale
if [ "$TOTAL_SIZE" -gt "$MAX_TOTAL_SIZE" ]; then
  echo "‚ùå La taille totale des fichiers dans ce commit est trop √©lev√©e (${TOTAL_SIZE} octets)."
  echo "üì¶ Limite totale autoris√©e : ${MAX_TOTAL_SIZE} octets."
  exit 1
fi

# Tout est bon
exit 0
